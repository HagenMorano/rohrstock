# Rohrstock

To install dependencies:

```bash
bun install
```

To run:

```bash
bun start
```

## Idea

### File based routes

- Routes can be any kind of Response and any HTTP method
- Routes may contain multiple Responses
- It is possible to override the slug and / or the path that is generated by the filename / file structure

### Easy to host

- Includes a server (bun)
- No build step by default
- No dev / prod diffs
- Docker is recommended

### Static Site Generation from remote source

- Provides an easy interface for generating content from a remote source
- Remote source can be an object for a single route or an array of objects for dynamically created routes
- Static Site Generation doesn't mean your pages have to be and/or stay static! Rohrstock provides ways to revalidate routes.
- Routes don't have to be static. They may also fetch their remote source data on every request (SSR)

### In-memory routes

- Routes are served statically from an in memory object instead of generated files at build time. This makes the performance of content serving even faster as there is no file read process involved.
- There might be a plugin for using the file system or some kind of cache like Redis instead of saving them in-memory in the future to make large Rohrstock projects work on low-spec servers.

### No config file(s)

- Rohrstock comes as is. There is no predefined way to define a standard behavior for all routes or tweak the server behavior.
- If you want a standard behavior, make sure to create your own abstractions - this is one of the core ideas of Rohrstock.

### Excessive logs

- Meta frameworks are sometimes hard to debug - especially the server part. Rohrstock tries to catch all potential error cases and provides excessive logs, especially in dev mode to identify flaws before they come to production.

### Avoid complexity

- Rohrstock tries to provide a solid and flexible base for projects of all sizes
- There will never be bundlers, minifiers, task runners, configuration files etc. except you include them yourself
- There will never be more than two dependencies in Rohrstock: Bun and Typescript

## Magic

Rohrstock comes with very few "magic".

### File based routing

You don't have to define the paths of your HTTP responses in the server section of Rohrstock / Bun. Instead, the path of your response will be automatically determined by reading the path of your files inside the /routes directory (if not defined otherwise in the route file itself).

### The Route

All files in the `/routes` direction should default export a `Route` object. See the type model for what configuration options there are.

### Magic routes

There are only a few "magic" routes that will be handled different than any others:

#### `index.js`

Whenever an index.js file is defined, its path will resolve to the root of the corresponding folder:

`/routes/index.js` -> `example.com/`
`/routes/sub-folder/index.js` -> `example.com/sub-folder/`

You can force the slug to be "index" by setting `slug: "index"` in the route.

#### `/404.js`

To be able to define a custom 404 page, add a `404.js` file in the root of the routes section. The route can be defined like any regular route besides following restrictions:

1. You don't have access to the other routes of the server in your build function
2. You have to return a single route

### Redirects

Define redirects by creating a `redirects.js` file at the root of your project.

```ts
// The returned string is the redirect
// @Todo check if there should be more options for redirects
type Redirect = () => string | void;

export default (url: URL) => {
  if (url.hostname === "my-second-domain.com") {
    return "my-first-domain.com"
  }
  // If no condition fits, there will be no redirect.
} as Redirect;
```

## Update Rohrstock

To update Rohrstock, remove your current `server` directory and replace it with the `server` directory from the Rohrstock repository. Rohrstock should never introduce breaking changes within the same major version.

You should _never_ tweak code in the server directory yourself.

## Inspiration

- https://bun.sh
- https://css-tricks.com/reactive-uis-vanillajs-part-1-pure-functional-style/
- https://ahastack.dev/aha/1-stack-overview/
- https://frontendmastery.com/posts/navigating-the-future-of-frontend/?ck_subscriber_id=1889269872
- http://vanilla-js.com/
- https://stenciljs.com/docs/goals-and-objectives
  - _The code generated by Stencil does not rely on Stencil, but rather it generates highly-optimized, framework-free, stand-alone code which runs natively in the browser._
- https://typeofnan.dev/roll-your-own-javascript-immutability-function-using-the-proxy-object/
- https://htmx.org/essays/no-build-step/
